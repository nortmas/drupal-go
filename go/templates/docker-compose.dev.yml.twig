version: '3'

services:
  php:
    environment:
      GIT_USER_NAME: 'wodby-dev'
    volumes:
      - /tmp/:/tmp/

  apache:
    networks:
      - default
      - proxy
    labels:
      traefik.frontend.redirect.entryPoint: 'https'
{% if multisite is not empty %}
      traefik.frontend.rule: 'HostRegexp:{{ project_machine_name }}.{subdomain:[a-z]+}.dev.{{ gitlab.staging_domain }}'
{% else %}
      traefik.frontend.rule: 'Host:{{ project_machine_name }}.dev.{{ gitlab.staging_domain }}'
{% endif %}
{% if behat.enable %}

  selenium:
    image: selenium/standalone-chrome
    container_name: '{{ project_machine_name }}_selenium'
    restart: on-failure:5
    volumes:
      - /dev/shm:/dev/shm
    labels:
      - 'traefik.backend=selenium'
      - 'traefik.port=4444'
      - 'traefik.frontend.rule=Host:selenium.{{ project_machine_name }}.docker.localhost'
    ports:
      - 5900:5900
{% endif %}

networks:
  proxy:
    external: true